<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿éšªéœ€æ±‚å°èˆªç³»çµ±</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --bg: #f5f7fa;
            --card-bg: #ffffff;
            --text: #333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background-color: var(--card-bg);
            width: 100%;
            max-width: 600px;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
        }

        h1, h2 { text-align: center; color: var(--primary); margin-bottom: 20px; }
        p { text-align: center; color: #666; margin-bottom: 30px; line-height: 1.6; }

        .progress-bar {
            height: 6px;
            background: #eee;
            border-radius: 3px;
            margin-bottom: 30px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.3s ease;
        }

        .option-btn {
            display: block;
            width: 100%;
            padding: 15px 20px;
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 16px;
            line-height: 1.4;
            color: #444;
        }

        .option-btn:hover {
            border-color: var(--accent);
            background-color: #f0f8ff;
        }

        .option-btn:active {
            transform: scale(0.99);
        }

        .step { display: none; animation: fadeIn 0.4s; }
        .step.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* è¼¸å…¥æ¡†æ¨£å¼å„ªåŒ– */
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
            font-size: 0.95em;
        }

        input[type="text"], input[type="tel"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
            background: #fafafa;
        }
        
        /* æ€§åˆ¥é¸æ“‡æ¨£å¼ */
        .radio-group {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .radio-label {
            display: flex;
            align-items: center;
            font-weight: normal;
            cursor: pointer;
            background: #fafafa;
            padding: 10px 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        .radio-label input { margin-right: 8px; }

        .nav-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: background 0.3s;
        }
        .nav-btn:hover { background-color: #1a252f; }
        
        #loading-spinner {
            display: none;
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>

    <div id="step-intro" class="step active">
        <h2>ğŸ“‹ ä¿éšªéœ€æ±‚å°èˆª</h2>
        <p>é€™æ˜¯ä¸€ä»½å”åŠ©æ‚¨é‡æ¸…åƒ¹å€¼è§€çš„äº’å‹•å•å·ã€‚<br>è«‹å¡«å¯«åŸºæœ¬è³‡æ–™ä»¥åˆ©æº–ç¢ºåˆ†æã€‚</p>
        
        <label>è¼¸å…¥ä½ å°Šè²´çš„å¤§å</label>
        <input type="text" id="clientName" placeholder="è«‹è¼¸å…¥å§“å">
        
        <label>ç”Ÿç†æ€§åˆ¥</label>
        <div class="radio-group">
            <label class="radio-label"><input type="radio" name="clientSex" value="ç”·"> ç”·</label>
            <label class="radio-label"><input type="radio" name="clientSex" value="å¥³"> å¥³</label>
        </div>

        <label>å‡ºç”Ÿå¹´æœˆæ—¥ (å¦‚ï¼šè¥¿å…ƒ1986/01/01è«‹è¼¸å…¥19860101)</label>
        <input type="tel" id="clientDob" placeholder="19860101" maxlength="8">

        <label>ç›®å‰è·æ¥­(å¦‚æœæ˜¯æ–œæ§“äººï¼ŒæŠŠæ‰€æœ‰è·æ¥­éƒ½å¯«å–”ï¼)</label>
        <input type="text" id="clientJob" placeholder="ä¾‹å¦‚ï¼šè»Ÿé«”å·¥ç¨‹å¸«ã€è¡Œæ”¿äººå“¡">
        
        <div style="border-top: 1px dashed #ccc; margin: 30px 0 20px 0;"></div>

        <label style="font-size: 1.1em; color: #e67e22;">é€™æ¬¡çš„è¦åŠƒå°è±¡æ˜¯ï¼Ÿ</label>
        <div id="target-selection">
            <button class="option-btn" onclick="selectTarget('self')">A. åªæœ‰æˆ‘è‡ªå·±</button>
            <button class="option-btn" onclick="selectTarget('family')">B. å®¶äºº</button>
            <button class="option-btn" onclick="selectTarget('both')">C. å…©è€…éƒ½è¦ï¼ˆæˆ‘ + å®¶äººï¼‰</button>
        </div>
    </div>

    <div id="step-question" class="step">
        <h4 id="q-category" style="text-align:center; color:#999; margin-bottom:5px; font-weight:normal;">é¡åˆ¥</h4>
        <p id="q-text" style="font-size: 1.3em; font-weight: bold; color: #2c3e50; margin-top:0;">å•é¡Œå…§å®¹</p>
        <div id="q-options"></div>
    </div>

    <div id="step-transition" class="step">
        <h2>ğŸ‰ ç¬¬ä¸€éšæ®µå®Œæˆ</h2>
        <p>æ‚¨å€‹äººçš„éœ€æ±‚åˆ†æå·²è¨˜éŒ„ã€‚</p>
        <p>æ¥ä¸‹ä¾†å°‡é€²å…¥ã€Œå®¶äººä¿éšœã€çš„éœ€æ±‚æª¢æ ¸ã€‚</p>
        <button class="nav-btn" onclick="startFamilyPhase()">ç¹¼çºŒå¡«å¯«å®¶äººéƒ¨åˆ† â”</button>
    </div>

    <div id="step-result" class="step">
        <div id="final-message">
            <h2>ğŸ”„ è³‡æ–™è™•ç†ä¸­</h2>
            <p>æ­£åœ¨åˆ†ææ‚¨çš„éœ€æ±‚åå¥½ä¸¦å‚³é€è‡³ç³»çµ±...</p>
            <div id="loading-spinner">â³ ä¸Šå‚³ä¸­...</div>
        </div>
    </div>

</div>

<script>
    // ğŸ”´ ä½ çš„ Google Script ç¶²å€ (å·²æ•´åˆ)
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwNNc9BZ0AJzTGGYK4cnqAsuA78FtWMuuVoJMmn4hZpOSWuVCy0N6eLyPk-h414ZkJD/exec';

    // === é¡Œåº«è³‡æ–™ (å®Œæ•´ç‰ˆ 20+20) ===
    
    // è‡ªæˆ‘è¦åŠƒé¡Œåº«
    const questionsSelf = [
        // ç¬¬ä¸€éšæ®µï¼šç”Ÿå­˜ç„¦æ…® (1-10)
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "é—œæ–¼æœªä¾†çš„é¢¨éšªï¼Œä½ æœ€å®³æ€•ç™¼ç”Ÿå“ªç¨®ç‹€æ³ï¼Ÿ", a: "æ´»å¾—å¤ªä¹…ï¼Œä½†éŒ¢ä¸å¤ ç”¨ï¼ˆæ€•è€/ç—…ï¼‰", b: "èµ°å¾—å¤ªæ—©ï¼Œè²¬ä»»æ²’äººæ‰›ï¼ˆæ€•æ­»/è²¬ä»»ï¼‰", tag: "A:ç”Ÿå­˜é¢¨éšª vs B:è²¬ä»»é¢¨éšª" },
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "å¦‚æœèº«é«”å‡ºç‹€æ³ï¼Œä½ æœ€ç„¡æ³•æ¥å—çš„æ˜¯ï¼Ÿ", a: "ç”Ÿæ´»å“è³ªè¢«è¿«ä¸‹é™", b: "å­˜æ¬¾ç©è“„ç¬é–“æ­¸é›¶", tag: "A:å“è³ªå°å‘ vs B:è³‡ç”¢ä¿å…¨" },
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "å°ä½ ä¾†èªªï¼Œè²·ä¿éšªæ˜¯ç‚ºäº†ï¼Ÿ", a: "ç”Ÿç—…æ™‚æœ‰æ›´å¥½çš„æ²»ç™‚é¸æ“‡", b: "ä¸èƒ½å·¥ä½œæ™‚ï¼Œè–ªæ°´èƒ½è¢«å¡«è£œ", tag: "A:é†«ç™‚æ¬Š vs B:æ”¶å…¥æ¬Š" },
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "å¦‚æœåªèƒ½å…ˆè§£æ±ºä¸€å€‹æ“”æ†‚ï¼Œä½ æœƒå„ªå…ˆè™•ç†ï¼Ÿ", a: "éœ€é•·æœŸè¢«äººç…§é¡§ï¼Œå¤±å»å°Šåš´", b: "çªç„¶ç½¹æ‚£é‡ç—…ï¼Œæªæ‰‹ä¸åŠ", tag: "A:é•·ç…§å¤±èƒ½ vs B:é‡å¤§å‚·ç—…" },
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "æƒ³åƒç”Ÿç—…æ™‚ï¼Œå“ªç¨®å£“åŠ›æœƒè®“ä½ æ›´ç„¦æ…®ï¼Ÿ", a: "æ¯æœˆå›ºå®šçš„é•·æœŸé–‹éŠ·ï¼ˆæˆ¿è²¸/çœ‹è­·ï¼‰", b: "åˆæœŸçš„ä¸€å¤§ç­†æ‰‹è¡“æˆ–å™¨æè²»", tag: "A:æŒçºŒå£“åŠ› vs B:ç¬é–“å£“åŠ›" },
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "ä¸æƒ³æ‹–ç´¯å®¶äººï¼Œä½ æ˜¯æŒ‡ï¼Ÿ", a: "ä¸æƒ³è®“å®¶äººèŠ±æ™‚é–“æˆ–é«”åŠ›ç…§é¡§æˆ‘", b: "ä¸æƒ³è®“å®¶äººæ‹¿éŒ¢å‡ºä¾†å¹«æˆ‘ä»˜é†«è—¥è²»", tag: "A:é•·ç…§æ—¥é¡ vs B:å¯¦æ”¯ä¸€æ¬¡é‡‘" },
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "å°æ–¼æœªçŸ¥çš„é¢¨éšªï¼Œä½ å‚¾å‘çš„ç­–ç•¥æ˜¯ï¼Ÿ", a: "ç´°æ°´é•·æµï¼Œæ¯å€‹æœˆæœ‰éŒ¢é€²ä¾†è®“æˆ‘é‹ç”¨", b: "ä¹¾è„†ä¿è½ï¼Œç›´æ¥çµ¦æˆ‘ä¸€ç­†éŒ¢è®“æˆ‘è‡ªå·±çœ‹è‘—è¾¦", tag: "A:å¹´é‡‘æœˆçµ¦ä»˜ vs B:ä¸€æ¬¡çµ¦ä»˜" },
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "å¦‚æœçœŸçš„ç™¼ç”Ÿå¤±èƒ½ç‹€æ³ï¼Œä½ å¸Œæœ›ï¼Ÿ", a: "ç¢ºä¿æ¯å€‹æœˆæœ‰éŒ¢è«‹äººç…§é¡§", b: "å…ˆæ‹¿ä¸€ç­†éŒ¢æ”¹å–„å±…å®¶ç’°å¢ƒæˆ–æ‡‰æ€¥", tag: "A:æŒçºŒçµ¦ä»˜ vs B:ä¸€æ¬¡çµ¦ä»˜" },
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "ä½ æ¯”è¼ƒå–œæ­¡å“ªç¨®ã€Œå®‰å…¨æ„Ÿã€ï¼Ÿ", a: "åƒé ˜è–ªæ°´ä¸€æ¨£ï¼Œæºæºä¸çµ•çš„ç©©å®šæ„Ÿ", b: "åƒä¸­æ¨‚é€ä¸€æ¨£ï¼Œæ‰‹æ¡å¤§ç­†è³‡é‡‘çš„æŒæ¡æ„Ÿ", tag: "A:æŒçºŒå‹ vs B:å•Ÿå‹•å‹" },
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "é€™æ¬¡è¦åŠƒçš„æœ€çµ‚ç›®æ¨™ï¼Œä½ å¸Œæœ›é”æˆï¼Ÿ", a: "è®“æˆ‘çš„æœªä¾†ç”Ÿæ´»æ°´æº–ã€Œæ’å¾—ä½ã€", b: "è®“çªç™¼çš„æ„å¤–æ‰“æ“Šã€Œä¸è‡´å‘½ã€", tag: "A:æ’æ™‚é–“å‹ vs B:æ“‹ç½é›£å‹" },
        
        // ç¬¬äºŒéšæ®µï¼šä½¿ç”¨æƒ…å¢ƒ (11-20)
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "å¦‚æœå¿…é ˆä½é™¢ï¼Œä½ æ¯”è¼ƒåœ¨æ„ï¼Ÿ", a: "å‡ç­‰ç—…æˆ¿å·®é¡ã€è–ªæ°´æå¤±èƒ½è£œå›ä¾†", b: "è‡ªè²»è—¥ç‰©ã€æ‰‹è¡“è€—æè²»ç”¨å¤ ä¸å¤ ä»˜", tag: "A:æ—¥é¡æ…°å• vs B:å¯¦æ”¯å¯¦ä»˜" },
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "ä»¥ä½ ç›®å‰çš„å·¥ä½œèˆ‡ç”Ÿæ´»å‹æ…‹ï¼Œä½ è¦ºå¾—å“ªå€‹æ©Ÿç‡é«˜ï¼Ÿ", a: "èº«é«”æ©Ÿèƒ½é€€åŒ–ã€æ…¢æ€§ç—…ã€æ–‡æ˜ç—…", b: "å¤–å‡ºé€šå‹¤é¢¨éšªã€é‹å‹•å‚·å®³ã€æ„å¤–äº‹æ•…", tag: "A:é†«ç™‚å‹ vs B:æ„å¤–å‹" },
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "å¦‚æœéœ€è¦ä¼‘é¤Š 3 å€‹æœˆä¸èƒ½å·¥ä½œï¼Œä½ å¸Œæœ›ï¼Ÿ", a: "ä¿éšªç†è³ èƒ½æŒ‰æœˆå½Œè£œæˆ‘çš„è–ªæ°´æå¤±", b: "ä¿éšªç›´æ¥è³ ä¸€ç­†éŒ¢ï¼Œç•¶ä½œç·Šæ€¥é å‚™é‡‘", tag: "A:æ—¥é¡å¤±èƒ½ vs B:ä¸€æ¬¡é‡‘" },
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "å“ªä¸€ç¨®æƒ…å¢ƒæ¯”è¼ƒå®¹æ˜“ç™¼ç”Ÿåœ¨ä½ èº«ä¸Šï¼Ÿ", a: "å› ç‚ºå¥åº·å•é¡Œï¼Œåè¦†é€²å‡ºé†«é™¢æª¢æŸ¥æ²»ç™‚", b: "å› ç‚ºçªç™¼æ„å¤–ï¼Œéœ€è¦ä¸€æ¬¡æ€§çš„æ‰‹è¡“æˆ–å¾©å¥", tag: "A:é†«ç™‚å‹ vs B:æ„å¤–å‹" },
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "å¦‚æœé†«ç™‚è¡Œç‚ºéœ€è¦é•·æœŸæŠ—æˆ°ï¼Œä½ åå¥½ï¼Ÿ", a: "æ¯æ¬¡å›è¨ºã€æ²»ç™‚éƒ½æœ‰éŒ¢æ‹¿ï¼ˆæ„Ÿè¦ºæ²’è™§ï¼‰", b: "ç¢ºè¨ºç•¶ä¸‹å°±æ‹¿ä¸€å¤§ç­†éŒ¢ï¼ˆè½è¢‹ç‚ºå®‰ï¼‰", tag: "A:ç™‚ç¨‹å‹ vs B:é‡å¤§å‚·ç—…" },
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "ä½ å°ã€Œå¯¦ç”¨ã€çš„å®šç¾©æ˜¯ï¼Ÿ", a: "ç†è³ é »ç‡é«˜ï¼Œå°ç—…å°ç—›éƒ½èƒ½è³ ", b: "ç†è³ é‡‘é¡å¤§ï¼Œç™¼ç”Ÿå¤§äº‹æ‰å•Ÿå‹•", tag: "A:å»£åº¦é†«ç™‚ vs B:æ·±åº¦é‡å¤§" },
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "å¦‚æœç”Ÿç—…äº†ï¼Œä½ æœ€æ“”å¿ƒå½±éŸ¿åˆ°ï¼Ÿ", a: "æˆ‘çš„è·æ¶¯ç™¼å±•èˆ‡å·¥ä½œæ”¶å…¥", b: "æˆ‘çš„å­˜æ¬¾æ°´ä½èˆ‡æŠ•è³‡è¨ˆåŠƒ", tag: "A:è–ªè³‡è£œå„Ÿ vs B:é«˜é¡é†«ç™‚" },
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "å¦‚æœåªèƒ½é¸ä¸€ç¨®ä½é™¢ä¿éšœï¼Ÿ", a: "ä½å¹¾å¤©è³ å¹¾å¤©ï¼ˆå®šé¡ï¼‰", b: "èŠ±å¤šå°‘è³ å¤šå°‘ï¼ˆå¯¦æ”¯ï¼‰", tag: "A:ä½é™¢æ—¥é¡ vs B:å¯¦æ”¯å¯¦ä»˜" },
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "ç›´è¦ºä¸Šï¼Œä½ è¦ºå¾—è‡ªå·±æœªä¾† 5 å¹´å…§ï¼Ÿ", a: "çœ‹é†«ç”Ÿçš„é »ç‡æœƒè®Šé«˜", b: "é‡åˆ°æ„å¤–çš„é¢¨éšªæœƒè®Šé«˜", tag: "A:é†«ç™‚å„ªå…ˆ vs B:æ„å¤–å„ªå…ˆ" },
        { cat: "ã€è‡ªæˆ‘ã€‘", q: "æœ€å¾Œæ±ºç­–ï¼Œå¦‚æœé ç®—æœ‰é™ï¼Œä½ æƒ³å…ˆä¿ä½ï¼Ÿ", a: "æ¯å¤©çš„ç”Ÿæ´»è²»èˆ‡ç…§é¡§è²»", b: "é«˜æ˜‚çš„é†«ç™‚è²»èˆ‡æ‰‹è¡“è²»", tag: "A:é•·ç…§æ—¥é¡ vs B:å¯¦æ”¯é‡å¤§" }
    ];

    // å®¶äººè¦åŠƒé¡Œåº«
    const questionsFamily = [
        // ç¬¬ä¸€éšæ®µï¼šç…§é¡§è²¬ä»» (1-10)
        { cat: "ã€å®¶äººã€‘", q: "ç•¶å®¶äººç”Ÿç—…æ™‚ï¼Œä½ æœ€æ“”å¿ƒçš„è¡æ“Šæ˜¯ï¼Ÿ", a: "æ¼«é•·çš„ç…§é¡§éç¨‹ï¼ŒéŒ¢åƒç„¡åº•æ´", b: "çªç„¶çš„ä¸€å ´å¤§ç—…ï¼Œæ‹¿ä¸å‡ºæ€¥ç”¨é‡‘", tag: "A:é•·æœŸéŒ¢å‘ vs B:æ€¥ç”¨ç¼ºå£" },
        { cat: "ã€å®¶äººã€‘", q: "è€ƒé‡åˆ°ä½ çš„å·¥ä½œèˆ‡ç”Ÿæ´»ï¼Œä½ æ¯”è¼ƒæ€•ï¼Ÿ", a: "å®¶äººç—…æ³æ‹–å¾ˆä¹…ï¼Œéœ€è¦é•·æœŸæŠ—æˆ°", b: "ç‹€æ³ç™¼ç”Ÿå¾—å¤ªçªç„¶ï¼Œæªæ‰‹ä¸åŠ", tag: "A:é•·ç…§é¢¨éšª vs B:çªç™¼é¢¨éšª" },
        { cat: "ã€å®¶äººã€‘", q: "ä½œç‚ºç…§é¡§è€…ï¼Œä¿éšªå°ä½ æœ€é‡è¦çš„åŠŸèƒ½æ˜¯ï¼Ÿ", a: "æ¯å€‹æœˆæœ‰éŒ¢é€²ä¾†ï¼Œè®“æˆ‘èƒ½è«‹çœ‹è­·ï¼ˆè²·æ™‚é–“ï¼‰", b: "äº‹æƒ…ç™¼ç”Ÿæ™‚æœ‰ä¸€ç­†éŒ¢ï¼Œè®“æˆ‘å¥½è¾¦äº‹ï¼ˆè²·è³‡æºï¼‰", tag: "A:è²·äººåŠ›æ™‚é–“ vs B:è²·é†«ç™‚è³‡æº" },
        { cat: "ã€å®¶äººã€‘", q: "å¦‚æœå¿…é ˆåšå‡ºé¸æ“‡ï¼Œä½ æœƒå„ªå…ˆè™•ç†ï¼Ÿ", a: "æœªä¾†å¯èƒ½ç™¼ç”Ÿçš„å¤±æ™ºã€å¤±èƒ½ï¼ˆé•·æœŸä¾è³´ï¼‰", b: "ç™Œç—‡ã€è…¦ä¸­é¢¨ç­‰é‡å¤§å‚·ç—…ï¼ˆæ€¥éœ€æ²»ç™‚ï¼‰", tag: "A:é•·ç…§å¤±èƒ½ vs B:é†«ç™‚é‡å¤§" },
        { cat: "ã€å®¶äººã€‘", q: "å°æ–¼å®¶äººçš„å¥åº·é¢¨éšªï¼Œä½ æ¯”è¼ƒæ€•å“ªç¨®å£“åŠ›ï¼Ÿ", a: "åƒæˆ¿è²¸ä¸€æ¨£ï¼Œæ¯å€‹æœˆéƒ½è¦æ”¯å‡ºçš„å£“åŠ›", b: "åƒç‚¸å½ˆä¸€æ¨£ï¼Œä¸€æ¬¡çˆ†é–‹çš„å·¨é¡æ”¯å‡º", tag: "A:æœˆçµ¦ä»˜éœ€æ±‚ vs B:ä¸€æ¬¡é‡‘éœ€æ±‚" },
        { cat: "ã€å®¶äººã€‘", q: "è¦åŠƒé€™ä»½ä¿å–®ï¼Œä½ æœ€ä¸æƒ³çœ‹åˆ°çš„æƒ…æ³æ˜¯ï¼Ÿ", a: "ç‚ºäº†ç…§é¡§å®¶äººï¼Œæˆ‘ä¹Ÿè¢«è¿«è¾­è·æˆ–å½±éŸ¿ç”Ÿæ´»", b: "ç‚ºäº†æ•‘æ²»å®¶äººï¼Œå¿…é ˆè®Šè³£è³‡ç”¢æˆ–å€ŸéŒ¢", tag: "A:è–ªè³‡è£œå„Ÿ vs B:é«˜é¡é†«ç™‚" },
        { cat: "ã€å®¶äººã€‘", q: "å¦‚æœå®¶äººéœ€è¦äººç…§é¡§ï¼Œç›®å‰çš„å®¶åº­ç‹€æ³æ˜¯ï¼Ÿ", a: "äººåŠ›åƒç·Šï¼Œå¿…é ˆèŠ±éŒ¢è«‹çœ‹è­·æˆ–ä½æ©Ÿæ§‹", b: "äººåŠ›å¯ç…§é¡§ï¼Œä½†éœ€è¦éŒ¢è£œè²¼å®¶ç”¨", tag: "A:å¼·èª¿æœˆçµ¦ä»˜ vs B:å¼·èª¿ä¸€ç­†é‡‘" },
        { cat: "ã€å®¶äººã€‘", q: "å°æ–¼ä¸ç¢ºå®šæ€§ï¼Œä½ å‚¾å‘ï¼Ÿ", a: "æŠŠé¢¨éšªæ‹‰é•·ï¼Œåˆ†æ“”æœªä¾†çš„æ¯å€‹æœˆé–‹éŠ·", b: "æŠŠé¢¨éšªé›†ä¸­ï¼Œç•¶ä¸‹è§£æ±ºæœ€å¤§çš„è³‡é‡‘ç¼ºå£", tag: "A:æ’æ™‚é–“å‹ vs B:ä¸€æ¬¡çµ¦ä»˜å‹" },
        { cat: "ã€å®¶äººã€‘", q: "ä½ è¦ºå¾—å“ªç¨®ç†è³ æ–¹å¼ï¼Œå°å®¶åº­å’Œè«§æ¯”è¼ƒæœ‰å¹«åŠ©ï¼Ÿ", a: "å®šæœŸçµ¦ä»˜ï¼Œå°ˆæ¬¾å°ˆç”¨ä»˜çµ¦ç…§é¡§è€…/æ©Ÿæ§‹", b: "ä¸€æ¬¡çµ¦ä»˜ï¼Œç”±å®¶äººé–‹æœƒè¨è«–å¦‚ä½•é‹ç”¨", tag: "A:é¿å…çˆ­è­°å‹ vs B:éˆæ´»é‹ç”¨å‹" },
        { cat: "ã€å®¶äººã€‘", q: "æ•´é«”ä¾†èªªï¼Œä½ å¸Œæœ›é€™ä»½ä¿å–®èƒ½å¹«ä½ ï¼Ÿ", a: "è®“é€™å ´ç…§é¡§é¦¬æ‹‰æ¾è·‘å¾—å®Œ", b: "è®“é€™å ´çªç™¼ç½é›£èƒ½éé—œ", tag: "A:çºŒèˆªåŠ› vs B:çˆ†ç™¼åŠ›" },

        // ç¬¬äºŒéšæ®µï¼šä½¿ç”¨æƒ…å¢ƒ (11-20)
        { cat: "ã€å®¶äººã€‘", q: "å¦‚æœå®¶äººä½é™¢ï¼Œä½ æ¯”è¼ƒå¸Œæœ›ï¼Ÿ", a: "æ¯å¤©æœ‰ä¸€ç­†å›ºå®šé‡‘é¡ï¼Œè£œè²¼çœ‹è­·è²»æˆ–ç‡Ÿé¤Šé‡‘", b: "æ†‘æ”¶æ“šç†è³ ï¼ŒèŠ±å¤šå°‘è³ å¤šå°‘ï¼Œä¸ç”¨æ“”å¿ƒè—¥è²»", tag: "A:ä½é™¢æ—¥é¡ vs B:å¯¦æ”¯å¯¦ä»˜" },
        { cat: "ã€å®¶äººã€‘", q: "ä»¥é€™ä½å®¶äººçš„å¹´ç´€èˆ‡é«”æ³ï¼Œä½ è¦ºå¾—å“ªå€‹é¢¨éšªé«˜ï¼Ÿ", a: "è‡ªç„¶è€åŒ–ã€é€€åŒ–ã€æ…¢æ€§ç–¾ç—…", b: "è·Œå€’ã€éª¨æŠ˜ã€äº¤é€šäº‹æ•…ç­‰æ„å¤–", tag: "A:ç–¾ç—…å‹ vs B:æ„å¤–å‹" },
        { cat: "ã€å®¶äººã€‘", q: "å¦‚æœä½é™¢ 7~10 å¤©ï¼Œä½ æ¯”è¼ƒåœ¨æ„ï¼Ÿ", a: "è«‹çœ‹è­·ä¸€å¤© 3000 å…ƒçš„è²»ç”¨èƒ½ä¸èƒ½è¢«æ¶µè“‹", b: "é†«ç”Ÿå»ºè­°çš„è‡ªè²»æ‰‹è¡“/é†«æè²»èƒ½ä¸èƒ½ä»˜å¾—èµ·", tag: "A:æ—¥é¡å‹ vs B:å¯¦æ”¯å‹" },
        { cat: "ã€å®¶äººã€‘", q: "å“ªä¸€ç¨®ç‹€æ³ä½ æ¯”è¼ƒèƒ½æƒ³åƒç™¼ç”Ÿåœ¨ä»–/å¥¹èº«ä¸Šï¼Ÿ", a: "å› ç‚ºç–¾ç—…ï¼Œåè¦†é€²å‡ºé†«é™¢æ²»ç™‚", b: "å› ç‚ºä¸€æ¬¡æ„å¤–ï¼Œéœ€è¦ä¼‘é¤Šå¾©åŸ", tag: "A:é†«ç™‚å‹ vs B:æ„å¤–å‹" },
        { cat: "ã€å®¶äººã€‘", q: "å¦‚æœå®¶äººéœ€è¦é•·æœŸæ²»ç™‚ï¼ˆå¦‚æ´—è…ã€å¾©å¥ï¼‰ï¼Œä½ å¸Œæœ›ï¼Ÿ", a: "æ¯æ¬¡å»é†«é™¢éƒ½æœ‰éŒ¢é ˜ï¼ˆè£œè²¼è»Šè³‡/æ›è™Ÿï¼‰", b: "ç¢ºè¨ºç•¶ä¸‹æ‹¿ä¸€å¤§ç­†éŒ¢ï¼ˆè®“æˆ‘å€‘è‡ªå·±è¦åŠƒï¼‰", tag: "A:ç™‚ç¨‹å‹ vs B:ä¸€æ¬¡çµ¦ä»˜" },
        { cat: "ã€å®¶äººã€‘", q: "é€™ä»½ä¿å–®å°ä½ ä¾†èªªï¼Œæ€éº¼æ¨£æ‰ç®—ã€Œæœ‰ç”¨ã€ï¼Ÿ", a: "åªè¦æœ‰ä½é™¢æˆ–æ‰‹è¡“å°±èƒ½è³ ï¼Œæ„Ÿè¦ºæ¯”è¼ƒå®‰å¿ƒ", b: "åªæœ‰ç™¼ç”Ÿå¤§äº‹æ‰è³ æ²’é—œä¿‚ï¼Œä½†è¦è³ å¾—å¤ å¤š", tag: "A:é«˜é »ç‡é†«ç™‚ vs B:é«˜ä¿é¡é‡å¤§" },
        { cat: "ã€å®¶äººã€‘", q: "ä½ è¦ºå¾—å“ªä¸€ç¨®ç‹€æ³ï¼Œæ¯”è¼ƒå®¹æ˜“æ‰“äº‚ä½ çš„ç”Ÿæ´»ç¯€å¥ï¼Ÿ", a: "å®¶äººç”Ÿç—…ï¼Œéœ€è¦é »ç¹æ¥é€é™ªè¨º", b: "çªç„¶ç™¼ç”Ÿæ„å¤–ï¼Œéœ€è¦ç·Šæ€¥è™•ç†äº‹å‹™", tag: "A:é†«ç™‚çœ‹è­· vs B:æ„å¤–æ€¥é›£" },
        { cat: "ã€å®¶äººã€‘", q: "å¦‚æœåªèƒ½é¸ä¸€ç¨®ä½é™¢ä¿éšœçµ¦å®¶äººï¼Ÿ", a: "ä¸ç®¡èŠ±å¤šå°‘ï¼Œæœ‰ä½é™¢å°±çµ¦éŒ¢ï¼ˆå®šé¡ï¼‰", b: "åªæœ‰ç¬¦åˆå¥ä¿ä¸çµ¦ä»˜çš„é …ç›®æ‰è³ ï¼ˆå¯¦æ”¯ï¼‰", tag: "A:æ„Ÿè¦ºå‹æ—¥é¡ vs B:å¯¦ç”¨å‹å¯¦æ”¯" },
        { cat: "ã€å®¶äººã€‘", q: "ç›´è¦ºä¾†çœ‹ï¼Œä½ è¦ºå¾—å“ªç¨®æ©Ÿç‡æ¯”è¼ƒé«˜ï¼Ÿ", a: "é†«ç™‚éœ€æ±‚éš¨è‘—å¹´ç´€æ…¢æ…¢å¢åŠ ", b: "æ„å¤–äº‹ä»¶çªç„¶ç™¼ç”Ÿ", tag: "A:é†«ç™‚é‡æ–¼æ„å¤– vs B:æ„å¤–é‡æ–¼é†«ç™‚" },
        { cat: "ã€å®¶äººã€‘", q: "æœ€å¾Œæ±ºç­–ï¼Œå¦‚æœåªèƒ½å…ˆè£œä¸€å¡Šæ‹¼åœ–ï¼Œä½ æœƒé¸ï¼Ÿ", a: "è·Ÿã€Œä½é™¢ã€ç”Ÿç—…æ²»ç™‚ã€ç›´æ¥ç›¸é—œçš„", b: "è·Ÿã€Œå¤±èƒ½ã€éœ€è¦äººç…§é¡§ã€ç›´æ¥ç›¸é—œçš„", tag: "A:çŸ­æœŸé†«ç™‚ vs B:é•·æœŸç…§è­·" }
    ];

    // === ç¨‹å¼é‚è¼¯ (Engine) ===
    let currentMode = ''; 
    let currentQueue = []; 
    let answers = []; 
    let currentIndex = 0;
    let doingFamilyAfterSelf = false; 

    function selectTarget(mode) {
        // --- ğŸ”’ é˜²å‘†é©—è­‰å€ (æª¢æŸ¥æ˜¯å¦æœ‰æ¼å¡«) ---
        const name = document.getElementById('clientName').value.trim();
        const dob = document.getElementById('clientDob').value.trim();
        const job = document.getElementById('clientJob').value.trim();
        
        // å–å¾—æ€§åˆ¥å–®é¸å€¼
        const sexEls = document.getElementsByName('clientSex');
        let sex = '';
        for(let el of sexEls) { if(el.checked) sex = el.value; }

        if (!name || !sex || !dob || !job) {
            alert("âš ï¸ è«‹è¼¸å…¥å°Šè²´çš„å¤§åã€æ€§åˆ¥ã€ç”Ÿæ—¥èˆ‡è·æ¥­ï¼Œæˆ‘å€‘æ‰èƒ½é–‹å§‹åˆ†æå–”ï¼");
            return;
        }
        // ---------------------

        currentMode = mode;
        document.getElementById('step-intro').classList.remove('active');
        document.getElementById('step-question').classList.add('active');
        
        if (mode === 'self' || mode === 'both') {
            currentQueue = questionsSelf;
        } else {
            currentQueue = questionsFamily;
        }
        
        loadQuestion();
    }

    function loadQuestion() {
        if (currentIndex >= currentQueue.length) {
            handleQueueFinish();
            return;
        }

        const qData = currentQueue[currentIndex];
        document.getElementById('q-category').innerText = qData.cat;
        
        // é¡Œè™Ÿé¡¯ç¤ºé‚è¼¯
        let displayNum = currentIndex + 1;
        document.getElementById('q-text').innerText = displayNum + ". " + qData.q;
        
        // é€²åº¦æ¢
        const progress = ((currentIndex) / currentQueue.length) * 100;
        document.getElementById('progress').style.width = progress + "%";

        const optionsHTML = `
            <button class="option-btn" onclick="saveAnswer('A', '${qData.tag}', '${qData.a}')">A. ${qData.a}</button>
            <button class="option-btn" onclick="saveAnswer('B', '${qData.tag}', '${qData.b}')">B. ${qData.b}</button>
        `;
        document.getElementById('q-options').innerHTML = optionsHTML;
    }

    function saveAnswer(choice, tag, detail) {
        const qData = currentQueue[currentIndex];
        answers.push({
            q: qData.q,
            choice: choice,
            detail: detail,
            tag: tag
        });

        currentIndex++;
        loadQuestion();
    }

    function handleQueueFinish() {
        if (currentMode === 'both' && !doingFamilyAfterSelf) {
            doingFamilyAfterSelf = true;
            document.getElementById('step-question').classList.remove('active');
            document.getElementById('step-transition').classList.add('active');
        } else {
            submitData();
        }
    }

    function startFamilyPhase() {
        document.getElementById('step-transition').classList.remove('active');
        document.getElementById('step-question').classList.add('active');
        currentQueue = questionsFamily;
        currentIndex = 0;
        loadQuestion();
    }

    // === ğŸŒŸ æ™ºæ…§åˆ†ææ ¸å¿ƒé‚è¼¯ (åŒ…å«æŠ“å–æ–°æ¬„ä½) ===
    function submitData() {
        document.getElementById('step-question').classList.remove('active');
        document.getElementById('step-result').classList.add('active');
        document.getElementById('loading-spinner').style.display = 'block';

        // ğŸŸ¢ é€™è£¡æ˜¯ä½ ä¹‹å‰æ¼æ‰çš„é—œéµï¼šè¦æŠŠ HTML è¼¸å…¥æ¡†çš„å€¼æŠ“é€²ä¾†
        const name = document.getElementById('clientName').value.trim();
        const dob = document.getElementById('clientDob').value.trim();
        const job = document.getElementById('clientJob').value.trim();
        const sexEls = document.getElementsByName('clientSex');
        let sex = '';
        for(let el of sexEls) { if(el.checked) sex = el.value; }

        // 1. åˆå§‹åŒ–è¨ˆåˆ†å™¨
        let self_p1_A = 0, self_p1_B = 0;
        let self_p2_A = 0, self_p2_B = 0;
        let fam_p1_A = 0, fam_p1_B = 0;
        let fam_p2_A = 0, fam_p2_B = 0;
        let keywords = [];

        // 2. æ™ºæ…§éæ­·ç­”æ¡ˆ
        answers.forEach((item, index) => {
            let isSelfQuestion = false;
            let isPhase1 = false;

            if (currentMode === 'self') {
                isSelfQuestion = true;
                isPhase1 = (index < 10);
            } else if (currentMode === 'family') {
                isSelfQuestion = false;
                isPhase1 = (index < 10);
            } else { // both mode
                if (index < 20) { // å‰20é¡Œæ˜¯è‡ªå·±
                    isSelfQuestion = true;
                    isPhase1 = (index < 10);
                } else { // å¾Œ20é¡Œæ˜¯å®¶äºº
                    isSelfQuestion = false;
                    isPhase1 = (index < 30);
                }
            }

            // ç´¯åŠ åˆ†æ•¸
            if (isSelfQuestion) {
                if (isPhase1) {
                    item.choice === 'A' ? self_p1_A++ : self_p1_B++;
                } else {
                    item.choice === 'A' ? self_p2_A++ : self_p2_B++;
                }
            } else {
                if (isPhase1) {
                    item.choice === 'A' ? fam_p1_A++ : fam_p1_B++;
                } else {
                    item.choice === 'A' ? fam_p2_A++ : fam_p2_B++;
                }
            }

            // æŠ“å–é—œéµå­—
            let tagParts = item.tag.split('vs');
            let keyTag = (item.choice === 'A') ? tagParts[0] : tagParts[1];
            if(keyTag) {
                keyTag = keyTag.replace(/[AB]:/g, '').trim(); 
                keywords.push(keyTag);
            }
        });

        // 3. ç”Ÿæˆå ±å‘Šæ–‡å­— (ğŸŸ¢ æŠŠæ€§åˆ¥ã€ç”Ÿæ—¥ã€è·æ¥­ æ”¾é€²å ±å‘Šè¡¨é ­)
        let finalReport = `ã€ğŸ“Š ä¿éšªéœ€æ±‚åˆ†æå ±å‘Šã€‘\n`;
        finalReport += `===================================\n`;
        // é€™è£¡ç¢ºä¿äº† Google Sheet æœƒæ”¶åˆ°å®Œæ•´è³‡è¨Š
        finalReport += `ğŸ§‘ å®¢æˆ¶ï¼š${name} (${sex}) | ç”Ÿæ—¥ï¼š${dob} | è·æ¥­ï¼š${job}\n`;
        finalReport += `ğŸ“‹ æ¨¡å¼ï¼š${currentMode === 'self' ? 'è‡ªæˆ‘' : (currentMode === 'family' ? 'å®¶äºº' : 'æ··åˆ')}\n\n`;
        
        // --- ç”Ÿæˆã€è‡ªæˆ‘è¦åŠƒã€‘å€å¡Š ---
        if (currentMode === 'self' || currentMode === 'both') {
            let s1_total = self_p1_A + self_p1_B;
            let s2_total = self_p2_A + self_p2_B;
            let s1_pct = Math.round((self_p1_A / s1_total) * 100) || 0;
            let s2_pct = Math.round((self_p2_A / s2_total) * 100) || 0;

            finalReport += `ğŸ“Œ ã€è‡ªæˆ‘è¦åŠƒåˆ†æResultã€‘\n`;
            
            if (self_p1_A > self_p1_B) {
                finalReport += `ğŸ‘‰ ç”Ÿå­˜ç„¦æ…®ï¼šåå‘ã€æŒçºŒ/ç”Ÿå­˜å‹ã€‘(A:${s1_pct}%)\n   ğŸ’¡ æ´å¯Ÿï¼šé‡è¦–å°Šåš´èˆ‡ç¾é‡‘æµã€‚å»ºè­°ï¼šå¤±èƒ½/é•·ç…§/å¹´é‡‘ã€‚\n`;
            } else {
                finalReport += `ğŸ‘‰ ç”Ÿå­˜ç„¦æ…®ï¼šåå‘ã€ä¸€æ¬¡/è²¬ä»»å‹ã€‘(B:${100-s1_pct}%)\n   ğŸ’¡ æ´å¯Ÿï¼šé‡è¦–è³‡ç”¢ä¿å…¨ã€‚å»ºè­°ï¼šå£½éšª/ä¸€æ¬¡é‡‘/é ç•™ç¨…æºã€‚\n`;
            }

            if (self_p2_A > self_p2_B) {
                finalReport += `ğŸ‘‰ ä½¿ç”¨æƒ…å¢ƒï¼šåå‘ã€é†«ç™‚/æ—¥é¡å‹ã€‘(A:${s2_pct}%)\n   ğŸ’¡ æ´å¯Ÿï¼šåœ¨æ„å¡«è£œæå¤±ã€‚å»ºè­°ï¼šé«˜é¡å¯¦æ”¯/æ—¥é¡ã€‚\n`;
            } else {
                finalReport += `ğŸ‘‰ ä½¿ç”¨æƒ…å¢ƒï¼šåå‘ã€æ„å¤–/é‡å¤§å‹ã€‘(B:${100-s2_pct}%)\n   ğŸ’¡ æ´å¯Ÿï¼šåœ¨æ„å¤§é¢¨éšªæ§“æ¡¿ã€‚å»ºè­°ï¼šé‡å¤§å‚·ç—…/æ„å¤–éšªã€‚\n`;
            }
            finalReport += `-----------------------------------\n`;
        }

        // --- ç”Ÿæˆã€å®¶äººè¦åŠƒã€‘å€å¡Š ---
        if (currentMode === 'family' || currentMode === 'both') {
            let f1_total = fam_p1_A + fam_p1_B;
            let f2_total = fam_p2_A + fam_p2_B;
            let f1_pct = Math.round((fam_p1_A / f1_total) * 100) || 0;
            let f2_pct = Math.round((fam_p2_A / f2_total) * 100) || 0;

            finalReport += `ğŸ“Œ ã€å®¶äººè¦åŠƒåˆ†æResultã€‘\n`;
            
            if (fam_p1_A > fam_p1_B) {
                finalReport += `ğŸ‘‰ ç…§é¡§è²¬ä»»ï¼šåå‘ã€æŒä¹…æˆ°å‹ã€‘(A:${f1_pct}%)\n   ğŸ’¡ æ´å¯Ÿï¼šæ€•é•·æœŸç‡’éŒ¢ã€‚å»ºè­°ï¼šé•·ç…§éšª/å¤±èƒ½éšªã€‚\n`;
            } else {
                finalReport += `ğŸ‘‰ ç…§é¡§è²¬ä»»ï¼šåå‘ã€æ€¥æ•‘é‡‘å‹ã€‘(B:${100-f1_pct}%)\n   ğŸ’¡ æ´å¯Ÿï¼šæ€•çªç™¼ç¼ºå£ã€‚å»ºè­°ï¼šé‡å¤§å‚·ç—…/ç™Œç—‡ä¸€æ¬¡é‡‘ã€‚\n`;
            }

            if (fam_p2_A > fam_p2_B) {
                finalReport += `ğŸ‘‰ ä½¿ç”¨æƒ…å¢ƒï¼šåå‘ã€è£œè²¼/é†«ç™‚å‹ã€‘(A:${f2_pct}%)\n   ğŸ’¡ æ´å¯Ÿï¼šåœ¨æ„çœ‹è­·è²»/æ—¥é¡è£œè²¼ã€‚\n`;
            } else {
                finalReport += `ğŸ‘‰ ä½¿ç”¨æƒ…å¢ƒï¼šåå‘ã€å¯¦æ”¯/æ„å¤–å‹ã€‘(B:${100-f2_pct}%)\n   ğŸ’¡ æ´å¯Ÿï¼šåœ¨æ„é«˜é¡è‡ªè²»/æ„å¤–æ”¯å‡ºã€‚\n`;
            }
            finalReport += `-----------------------------------\n`;
        }

        finalReport += `\nã€ğŸ”¥ å®¢æˆ¶ç—›é»æ¨™ç±¤ã€‘\n${keywords.join("ã€")}\n`;
        finalReport += `===================================\n`;
        
        // 4. æ‰“åŒ…å‚³é€
        let formData = {
            name: name,
            mode: currentMode,
            analysis: finalReport
        };

        fetch(scriptURL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'text/plain' },
            body: JSON.stringify(formData)
        })
        .then(() => {
            document.getElementById('final-message').innerHTML = `
                <div style="text-align:center; padding: 20px;">
                    <h2 style="color: #27ae60; font-size:3em; margin:0;">âœ…</h2>
                    <h2 style="color: #27ae60;">æäº¤æˆåŠŸï¼</h2>
                    <p>æ„Ÿè¬æ‚¨çš„å¡«å¯«ã€‚</p>
                    <p>ç³»çµ±å·²ç”Ÿæˆåˆ†æå ±å‘Šï¼Œé¡§å•å°‡å„˜é€Ÿèˆ‡æ‚¨è¯ç¹«ã€‚</p>
                    <button class="nav-btn" onclick="location.reload()" style="background:#95a5a6; margin-top:20px;">é—œé–‰æˆ–å¡«å¯«ä¸‹ä¸€ä»½</button>
                </div>
            `;
        })
        .catch(error => {
            document.getElementById('final-message').innerHTML = `<h2 style="color:red">å‚³é€å¤±æ•—</h2><p>è«‹æª¢æŸ¥ç¶²è·¯é€£ç·š</p>`;
        });
    }
</script>

</body>
</html>
